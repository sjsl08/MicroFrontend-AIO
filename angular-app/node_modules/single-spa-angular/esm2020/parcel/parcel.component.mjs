import { Component, ElementRef, Input, ChangeDetectionStrategy, } from '@angular/core';
import * as i0 from "@angular/core";
export class ParcelComponent {
    constructor(host) {
        this.host = host;
        this.config = null;
        this.mountParcel = null;
        this.onParcelMount = null;
        this.wrapWith = 'div';
        this.customProps = {};
        this.appendTo = null;
        this.handleError = (error) => console.error(error);
        this.hasError = false;
        this.wrapper = null;
        this.parcel = null;
        this.task = null;
    }
    ngOnChanges() {
        this.scheduleTask("update" /* Action.Update */, () => {
            if (this.parcel !== null && this.parcel.update) {
                return this.parcel.update(this.customProps);
            }
        });
    }
    ngOnInit() {
        this.scheduleTask("mount" /* Action.Mount */, () => {
            if ((typeof ngDevMode === 'undefined' || ngDevMode) && this.mountParcel === null) {
                throw new Error('single-spa-angular: the [mountParcel] binding is required when using the <parcel> component. You can either (1) import mountRootParcel from single-spa or (2) use the mountParcel prop provided to single-spa applications.');
            }
            this.wrapper = document.createElement(this.wrapWith);
            if (this.appendTo !== null) {
                this.appendTo.appendChild(this.wrapper);
            }
            else {
                this.host.nativeElement.appendChild(this.wrapper);
            }
            this.parcel = this.mountParcel(this.config, {
                ...this.customProps,
                domElement: this.wrapper,
            });
            if (this.onParcelMount !== null) {
                this.parcel.mountPromise.then(this.onParcelMount);
            }
            this.unmounted = false;
            return this.parcel.mountPromise;
        });
    }
    ngOnDestroy() {
        this.scheduleTask("unmount" /* Action.Unmount */, () => {
            if (this.parcel !== null && this.parcel.getStatus() === 'MOUNTED') {
                return this.parcel.unmount();
            }
        });
        if (this.wrapper !== null) {
            this.wrapper.parentNode.removeChild(this.wrapper);
        }
        this.unmounted = true;
    }
    scheduleTask(action, task) {
        if (this.hasError && action !== "unmount" /* Action.Unmount */) {
            // In an error state, we don't do anything anymore except for unmounting
            return;
        }
        this.task = (this.task || Promise.resolve())
            .then(() => {
            if (this.unmounted && action !== "unmount" /* Action.Unmount */) {
                // Never do anything once the angular component unmounts
                return;
            }
            return task();
        })
            .catch((error) => {
            this.task = Promise.resolve();
            this.hasError = true;
            if (error?.message) {
                error.message = `During '${action}', parcel threw an error: ${error.message}`;
            }
            if (typeof this.handleError === 'function') {
                this.handleError(error);
            }
            else {
                setTimeout(() => {
                    throw error;
                });
            }
            // No more things to do should be done -- the parcel is in an error state
            throw error;
        });
    }
}
/** @nocollapse */ ParcelComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ParcelComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
/** @nocollapse */ ParcelComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.2.2", type: ParcelComponent, isStandalone: true, selector: "parcel", inputs: { config: "config", mountParcel: "mountParcel", onParcelMount: "onParcelMount", wrapWith: "wrapWith", customProps: "customProps", appendTo: "appendTo", handleError: "handleError" }, usesOnChanges: true, ngImport: i0, template: '', isInline: true, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.2.2", ngImport: i0, type: ParcelComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'parcel',
                    template: '',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    standalone: true,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { config: [{
                type: Input
            }], mountParcel: [{
                type: Input
            }], onParcelMount: [{
                type: Input
            }], wrapWith: [{
                type: Input
            }], customProps: [{
                type: Input
            }], appendTo: [{
                type: Input
            }], handleError: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyY2VsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYnMvc2luZ2xlLXNwYS1hbmd1bGFyL3BhcmNlbC9zcmMvcGFyY2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBSUwsdUJBQXVCLEdBQ3hCLE1BQU0sZUFBZSxDQUFDOztBQW1CdkIsTUFBTSxPQUFPLGVBQWU7SUFlMUIsWUFBb0IsSUFBNkI7UUFBN0IsU0FBSSxHQUFKLElBQUksQ0FBeUI7UUFkeEMsV0FBTSxHQUF3QixJQUFJLENBQUM7UUFDbkMsZ0JBQVcsR0FBbUMsSUFBSSxDQUFDO1FBQ25ELGtCQUFhLEdBQXdCLElBQUksQ0FBQztRQUMxQyxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGdCQUFXLEdBQTRCLEVBQUUsQ0FBQztRQUMxQyxhQUFRLEdBQWdCLElBQUksQ0FBQztRQUM3QixnQkFBVyxHQUFHLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXRELGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsWUFBTyxHQUF1QixJQUFJLENBQUM7UUFDbkMsV0FBTSxHQUFrQixJQUFJLENBQUM7UUFDN0IsU0FBSSxHQUF5QixJQUFJLENBQUM7SUFFVSxDQUFDO0lBRXJELFdBQVc7UUFDVCxJQUFJLENBQUMsWUFBWSwrQkFBZ0IsR0FBRyxFQUFFO1lBQ3BDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7Z0JBQzlDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2FBQzdDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUks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O2FBQ3pCO2lCQUFNO2dCQUNMLFVBQVUsQ0FBQyxHQUFHLEVBQUU7b0JBQ2QsTUFBTSxLQUFLLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDLENBQUM7YUFDSjtZQUVELHlFQUF5RTtZQUN6RSxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7K0hBdkdVLGVBQWU7bUhBQWYsZUFBZSxxUkFKaEIsRUFBRTsyRkFJRCxlQUFlO2tCQU4zQixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxRQUFRO29CQUNsQixRQUFRLEVBQUUsRUFBRTtvQkFDWixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtvQkFDL0MsVUFBVSxFQUFFLElBQUk7aUJBQ2pCO2lHQUVVLE1BQU07c0JBQWQsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBhcmNlbCwgUGFyY2VsQ29uZmlnLCBBcHBQcm9wcyB9IGZyb20gJ3NpbmdsZS1zcGEnO1xuXG5jb25zdCBlbnVtIEFjdGlvbiB7XG4gIE1vdW50ID0gJ21vdW50JyxcbiAgVXBkYXRlID0gJ3VwZGF0ZScsXG4gIFVubW91bnQgPSAndW5tb3VudCcsXG59XG5cbi8vIFRoaXMgd2lsbCBiZSBwcm92aWRlZCB0aHJvdWdoIFRlcnNlciBnbG9iYWwgZGVmaW5pdGlvbnMgYnkgQW5ndWxhciBDTEkuIFRoaXMgd2lsbFxuLy8gaGVscCB0byB0cmVlLXNoYWtlIGF3YXkgdGhlIGNvZGUgdW5uZWVkZWQgZm9yIHByb2R1Y3Rpb24gYnVuZGxlcy5cbmRlY2xhcmUgY29uc3QgbmdEZXZNb2RlOiBib29sZWFuO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwYXJjZWwnLFxuICB0ZW1wbGF0ZTogJycsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxufSlcbmV4cG9ydCBjbGFzcyBQYXJjZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgY29uZmlnOiBQYXJjZWxDb25maWcgfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCkgbW91bnRQYXJjZWw6IEFwcFByb3BzWydtb3VudFBhcmNlbCddIHwgbnVsbCA9IG51bGw7XG4gIEBJbnB1dCgpIG9uUGFyY2VsTW91bnQ6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICBASW5wdXQoKSB3cmFwV2l0aCA9ICdkaXYnO1xuICBASW5wdXQoKSBjdXN0b21Qcm9wczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fTtcbiAgQElucHV0KCkgYXBwZW5kVG86IE5vZGUgfCBudWxsID0gbnVsbDtcbiAgQElucHV0KCkgaGFuZGxlRXJyb3IgPSAoZXJyb3I6IEVycm9yKSA9PiBjb25zb2xlLmVycm9yKGVycm9yKTtcblxuICBwcml2YXRlIGhhc0Vycm9yID0gZmFsc2U7XG4gIHByaXZhdGUgdW5tb3VudGVkPzogYm9vbGVhbjtcbiAgcHJpdmF0ZSB3cmFwcGVyOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHBhcmNlbDogUGFyY2VsIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgdGFzazogUHJvbWlzZTx2b2lkPiB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaG9zdDogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4pIHt9XG5cbiAgbmdPbkNoYW5nZXMoKTogdm9pZCB7XG4gICAgdGhpcy5zY2hlZHVsZVRhc2soQWN0aW9uLlVwZGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucGFyY2VsICE9PSBudWxsICYmIHRoaXMucGFyY2VsLnVwZGF0ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJjZWwudXBkYXRlKHRoaXMuY3VzdG9tUHJvcHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5zY2hlZHVsZVRhc2soQWN0aW9uLk1vdW50LCAoKSA9PiB7XG4gICAgICBpZiAoKHR5cGVvZiBuZ0Rldk1vZGUgPT09ICd1bmRlZmluZWQnIHx8IG5nRGV2TW9kZSkgJiYgdGhpcy5tb3VudFBhcmNlbCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ3NpbmdsZS1zcGEtYW5ndWxhcjogdGhlIFttb3VudFBhcmNlbF0gYmluZGluZyBpcyByZXF1aXJlZCB3aGVuIHVzaW5nIHRoZSA8cGFyY2VsPiBjb21wb25lbnQuIFlvdSBjYW4gZWl0aGVyICgxKSBpbXBvcnQgbW91bnRSb290UGFyY2VsIGZyb20gc2luZ2xlLXNwYSBvciAoMikgdXNlIHRoZSBtb3VudFBhcmNlbCBwcm9wIHByb3ZpZGVkIHRvIHNpbmdsZS1zcGEgYXBwbGljYXRpb25zLicsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMud3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy53cmFwV2l0aCk7XG5cbiAgICAgIGlmICh0aGlzLmFwcGVuZFRvICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuYXBwZW5kVG8uYXBwZW5kQ2hpbGQodGhpcy53cmFwcGVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaG9zdC5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMud3JhcHBlcik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGFyY2VsID0gdGhpcy5tb3VudFBhcmNlbCEodGhpcy5jb25maWchLCB7XG4gICAgICAgIC4uLnRoaXMuY3VzdG9tUHJvcHMsXG4gICAgICAgIGRvbUVsZW1lbnQ6IHRoaXMud3JhcHBlcixcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodGhpcy5vblBhcmNlbE1vdW50ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMucGFyY2VsLm1vdW50UHJvbWlzZS50aGVuKHRoaXMub25QYXJjZWxNb3VudCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudW5tb3VudGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gdGhpcy5wYXJjZWwubW91bnRQcm9taXNlO1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zY2hlZHVsZVRhc2soQWN0aW9uLlVubW91bnQsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnBhcmNlbCAhPT0gbnVsbCAmJiB0aGlzLnBhcmNlbC5nZXRTdGF0dXMoKSA9PT0gJ01PVU5URUQnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmNlbC51bm1vdW50KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy53cmFwcGVyICE9PSBudWxsKSB7XG4gICAgICB0aGlzLndyYXBwZXIucGFyZW50Tm9kZSEucmVtb3ZlQ2hpbGQodGhpcy53cmFwcGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLnVubW91bnRlZCA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIHNjaGVkdWxlVGFzayhhY3Rpb246IEFjdGlvbiwgdGFzazogKCkgPT4gdm9pZCB8IFByb21pc2U8YW55Pik6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhc0Vycm9yICYmIGFjdGlvbiAhPT0gQWN0aW9uLlVubW91bnQpIHtcbiAgICAgIC8vIEluIGFuIGVycm9yIHN0YXRlLCB3ZSBkb24ndCBkbyBhbnl0aGluZyBhbnltb3JlIGV4Y2VwdCBmb3IgdW5tb3VudGluZ1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudGFzayA9ICh0aGlzLnRhc2sgfHwgUHJvbWlzZS5yZXNvbHZlKCkpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnVubW91bnRlZCAmJiBhY3Rpb24gIT09IEFjdGlvbi5Vbm1vdW50KSB7XG4gICAgICAgICAgLy8gTmV2ZXIgZG8gYW55dGhpbmcgb25jZSB0aGUgYW5ndWxhciBjb21wb25lbnQgdW5tb3VudHNcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGFzaygpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMudGFzayA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLmhhc0Vycm9yID0gdHJ1ZTtcblxuICAgICAgICBpZiAoZXJyb3I/Lm1lc3NhZ2UpIHtcbiAgICAgICAgICBlcnJvci5tZXNzYWdlID0gYER1cmluZyAnJHthY3Rpb259JywgcGFyY2VsIHRocmV3IGFuIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5oYW5kbGVFcnJvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBObyBtb3JlIHRoaW5ncyB0byBkbyBzaG91bGQgYmUgZG9uZSAtLSB0aGUgcGFyY2VsIGlzIGluIGFuIGVycm9yIHN0YXRlXG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==